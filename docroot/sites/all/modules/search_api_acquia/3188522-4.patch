From 56f28a2746c07287f88720ca87b1997aff4e4f84 Mon Sep 17 00:00:00 2001
From: Jakob Perry <japerry007@gmail.com>
Date: Tue, 15 Dec 2020 09:57:41 -0800
Subject: [PATCH] Issue 3188522 by japerry: Fix incorrect Call to a member
 function getAcquiaSearchApiVersion() on string.

---
 search_api_acquia.module | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/search_api_acquia.module b/search_api_acquia.module
index a26f929..74aabf4 100644
--- a/search_api_acquia.module
+++ b/search_api_acquia.module
@@ -161,9 +161,7 @@ function search_api_acquia_search_api_index_load($indexes) {
 
   if (!$auto_switch_disabled && !$read_only_switch_disabled && $sub_active && !module_exists('acquia_search_multi_subs')) {
     foreach ($indexes as &$index) {
-      $server = $index->server;
-      if (empty($server) || !search_api_acquia_get_core_service($server->getAcquiaSearchApiVersion())->isPreferredCoreAvailable()
-      ) {
+      if (empty($index->server)) {
         // This covers circumstances where the Acquia Search service hasn't
         // been completely set up. Preventing an empty server machine name
         // from loading prevents array_flip errors in entity_load that are
@@ -171,6 +169,9 @@ function search_api_acquia_search_api_index_load($indexes) {
         continue;
       }
       $server = search_api_server_load($index->server);
+      if (!method_exists($server, 'getAcquiaSearchApiVersion') || !search_api_acquia_get_core_service($server->getAcquiaSearchApiVersion())->isPreferredCoreAvailable()) {
+        continue;
+      }
       if ($server && $server->class == 'acquia_search_service') {
         $index->read_only = '1';
         $conf['search_api_acquia_overrides'][$index->server]['overridden_by_acquia_search'] = SEARCH_API_ACQUIA_AUTO_OVERRIDE_READ_ONLY;
-- 
2.27.0

